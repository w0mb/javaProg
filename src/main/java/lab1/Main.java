package lab1;

import java.util.List;

public class Main {

    public static void main(String[] args) {
        try {
            System.out.println("startRun");

            // ?????????????? ?????? ? ??????????? ????????? ??????
            CommandLineArgs commandLineArgs = new CommandLineArgs(args);

            // ?????????????? DataProcessor ? ??????????? ???????????
            DataProcessor dataProcessor = new DataProcessor(commandLineArgs);

            // ???????? ?????? ?????? ??? ?????????
            List<String> filenames = commandLineArgs.getInputFiles();

            // ???????????? ????? ???????????????
            for (String filename : filenames) {
                try {
                    System.out.println("setting filename: " + filename);
                    dataProcessor.setFilename(filename);

                    // ???????? ?????????? ??????? (? ?????? ?????? ??? ?? ?????, ?.?. ??????????????? ????? ??????)
//                    dataProcessor.setNumThreads(4);

                    System.out.println("run processFile");
                    dataProcessor.processFile(); // ????????? ?????? ????? ??????????? ???????????????
                } catch (Exception e) {
                    System.out.println("error of file upload for file " + filename + ": " + e.getMessage());
                }
            }

            // ??????? ?????????? ????? ????????? ???? ??????
            dataProcessor.printStatistics(commandLineArgs);

            // ????? ?????????? ? ?????
            dataProcessor.writeResults();

        } catch (Exception e) {
            System.out.println("error during file write: " + e.getMessage());
        }
    }
}
